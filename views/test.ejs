<%- include("./partials/header") %>
<div class="ui container">
  <h2>This is API-AJAX TESTING PAGE</h2>
  <br>
  <button class="ui button" type="button" onclick="ajaxGet()">Push ME HARD Master</button>
  <div id="getResultDiv">
      <ul class="list-group">
    </ul>
  </div>
  <div class="ui placeholder segment">
    <div class="ui two column stackable center aligned grid">
      <div class="ui vertical divider">Or</div>
      <div class="middle aligned row">
        <div class="column">
          <div class="ui icon header">
            <i class="search icon"></i>
            Find Hospital
          </div>
          <div class="ui primary button" style="margin: 0 auto 0 auto !important;" onclick="searchDisplay()">
            Search
          </div>
        </div>
        <div class="column">
          <div class="ui icon header">
            <i class="medkit icon"></i>
            Add New Hospital
          </div>
          <div class="ui primary button" style="margin: 0 auto 0 auto !important;" onclick="addDisplay()">
            Create
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="ui segment"  id="choice-segment-1" style="display: none;">
    <div id="fuzzy-name" class="ui center aligned">
      <div class="ui header">Enter Hospital Name</div>
      <div class="ui icon input">
        <input id="HOSPITAL_NAME" type="text" placeholder="Search...">
        <i class="search icon"></i>
      </div>
      <button class="ui button" type="button" onclick="fuzzynameGet()">Search</button><br>
      <div class="ui icon input">
        <input id="STATE_NAME" type="text" placeholder="State Name...">    
        <i class="filter icon"></i>
      </div>
      <div class="ui icon input">
        <input id="COUNTY_NAME" type="text" placeholder="County/City Name...">      
        <i class="filter icon"></i>
      </div>
      <button class="ui button" type="button" onclick="fuzzyfilterGet()">Filter</button>
    </div>
  </div>
  <div class="ui segment"  id="choice-segment-2" style="display: none;">
    <div class="ui form" id="new-form">
      <div class="ui huge header">This will be a form</div>
    </div>
  </div>
 
  <div id="getResultDiv2">
    <ul class="list-group">
  </ul>
</div>
</div>



<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js" integrity="sha256-t8GepnyPmw9t+foMh3mKNvcorqNHamSKtKRxxpUEgFI=" crossorigin="anonymous"></script>
<script src="design.js"></script>
<script>

  //Search Display Logic
  function searchDisplay(){
    if ($("#choice-segment-2").css("display") == "block"){
      $('#choice-segment-2').transition("scale","1000ms");
      $('#choice-segment-1').transition("scale","1000ms");
    } else {
      $('#choice-segment-1').transition("scale");
    }
  }

  function addDisplay(){
    if ($("#choice-segment-1").css("display") == "block"){
      $('#choice-segment-1').transition("scale","1000ms");
      $('#choice-segment-2').transition("scale","1000ms");
    } else {
      $('#choice-segment-2').transition("scale");
    }
  }
  //LOCATION GET

  
  function fuzzynameGet(){
    var search_query = {
      HOSPITAL_NAME : $("#HOSPITAL_NAME").val(),
      STATE_NAME : "",
      COUNTY_NAME : "",
      HQ_CITY : "",
    }
    $.ajax({
      type : "GET",
      contentType: "application/json",
      url : "/api/fuzzy",
      data : search_query,
      dataType:"json",
      success: function(result){
        $('#getResultDiv2 ul').empty();
        $.each(result, function(i, hospital){
          $('#getResultDiv2 .list-group').append("HOSPITAL NAME - "+hospital.HOSPITAL_NAME + " FID KEY- " + hospital.FID + "<br>")
        });
        console.log("Success: ", result);
      },
      error : function(e) {
        $("#getResultDiv2").html("<strong>Error</strong>");
        console.log("ERROR: ", e);
      }
    });  
  }

  //FILTER MECHANISM
  function fuzzyfilterGet(){
    var search_query = {
      HOSPITAL_NAME : $("#HOSPITAL_NAME").val(),
      STATE_NAME : $("#STATE_NAME").val(),
      COUNTY_NAME : $("#COUNTY_NAME").val(),
      HQ_CITY : "",
    }
    $.ajax({
      type : "GET",
      contentType: "application/json",
      url : "/api/fuzzy",
      data : search_query,
      dataType:"json",
      success: function(result){
        $('#getResultDiv2 ul').empty();
        $.each(result, function(i, hospital){
          $('#getResultDiv2 .list-group').append("HOSPITAL NAME - "+hospital.HOSPITAL_NAME + " FID KEY- " + hospital.FID + "<br>")
        });
        console.log("Success: ", result);
      },
      error : function(e) {
        $("#getResultDiv2").html("<strong>Error</strong>");
        console.log("ERROR: ", e);
      }
    });  
  }


  // DO GET
  function ajaxGet(){
    $.ajax({
      type : "GET",
      url : "/api/getdata",
      success: function(result){
        $('#getResultDiv ul').empty();
        $.each(result, function(i, hospital){
          $('#getResultDiv .list-group').append("County Name - "+hospital.COUNTY_NAME + "<br>" + " FID KEY- " + hospital.FID + "<br>")
        });
        console.log("Success: ", result);
      },
      error : function(e) {
        $("#getResultDiv").html("<strong>Error</strong>");
        console.log("ERROR: ", e);
      }
    });  
  }

</script>
<script> document.getElementById("test").classList.add("active"); </script>
<script>
  //watson addon assitant (build incomplete)
window.watsonAssistantChatOptions = {
integrationID: "5e79a775-134a-4d7c-a0f1-9f70133207ac", // The ID of this integration.
region: "au-syd", // The region your integration is hosted in.
serviceInstanceID: "ff546963-32f2-41c0-8f8f-5f76b6340b62", // The ID of your service instance.
onLoad: function(instance) { instance.render(); }
};
setTimeout(function(){
  const t=document.createElement('script');
  t.src="https://web-chat.global.assistant.watson.appdomain.cloud/loadWatsonAssistantChat.js";
  document.head.appendChild(t);
});
</script>
</body>
</html>
